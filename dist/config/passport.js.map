{"version":3,"sources":["../../src/config/passport.js"],"names":["passport","require","LocalStrategy","Strategy","User","Driver","serializeUser","user","done","id","deserializeUser","findById","err","use","usernameField","passwordField","passReqToCallback","req","email","password","findOne","flash","comparePassword"],"mappings":";;AAAA,IAAMA,WAAWC,QAAQ,UAAR,CAAjB;AACA,IAAMC,gBAAgBD,QAAQ,gBAAR,EAA0BE,QAAhD;AACA,IAAMC,OAAOH,QAAQ,gBAAR,CAAb;AACA,IAAMI,SAASJ,QAAQ,kBAAR,CAAf;;AAEAD,SAASM,aAAT,CAAuB,UAASC,IAAT,EAAeC,IAAf,EAAqB;AAC1CA,OAAK,IAAL,EAAWD,KAAKE,EAAhB;AACD,CAFD;;AAIAT,SAASU,eAAT,CAAyB,UAASD,EAAT,EAAaD,IAAb,EAAmB;AAC1CJ,OAAKO,QAAL,CAAcF,EAAd,EAAkB,UAASG,GAAT,EAAcL,IAAd,EAAoB;AACpCC,SAAKI,GAAL,EAAUL,IAAV;AACD,GAFD;AAGD,CAJD;;AAMAP,SAASa,GAAT,CAAa,aAAb,EAA4B,IAAIX,aAAJ,CAAkB;AAC5CY,iBAAe,OAD6B;AAE5CC,iBAAe,UAF6B;AAG5CC,qBAAmB;AAHyB,CAAlB,EAIzB,UAASC,GAAT,EAAcC,KAAd,EAAqBC,QAArB,EAA+BX,IAA/B,EAAqC;AACtCJ,OAAKgB,OAAL,CAAa,EAAEF,OAAOA,KAAT,EAAb,EAA+B,UAASN,GAAT,EAAcL,IAAd,EAAoB;AACjD,QAAIK,GAAJ,EAAS,OAAOJ,KAAKI,GAAL,CAAP;AACT,QAAI,CAACL,IAAL,EAAW,OAAOC,KAAK,IAAL,EAAW,KAAX,EAAkBS,IAAII,KAAJ,CAAU,cAAV,EAA0B,eAA1B,CAAlB,CAAP;AACX,QAAI,CAACd,KAAKe,eAAL,CAAqBH,QAArB,CAAL,EAAqC,OAAOX,KAAK,IAAL,EAAW,KAAX,EAAkBS,IAAII,KAAJ,CAAU,cAAV,EAA0B,gBAA1B,CAAlB,CAAP;AACrC,WAAOb,KAAK,IAAL,EAAWD,IAAX,CAAP;AACD,GALD;AAMD,CAX2B,CAA5B","file":"passport.js","sourcesContent":["const passport = require('passport');\nconst LocalStrategy = require('passport-local').Strategy;\nconst User = require('../models/user');\nconst Driver = require('../models/driver');\n\npassport.serializeUser(function(user, done) {\n  done(null, user.id);\n});\n\npassport.deserializeUser(function(id, done) {\n  User.findById(id, function(err, user) {\n    done(err, user);\n  });\n});\n\npassport.use('local-login', new LocalStrategy({\n  usernameField: 'email',\n  passwordField: 'password',\n  passReqToCallback: true\n}, function(req, email, password, done) {\n  User.findOne({ email: email }, function(err, user) {\n    if (err) return done(err);\n    if (!user) return done(null, false, req.flash('loginMessage', 'No user found'));\n    if (!user.comparePassword(password)) return done(null, false, req.flash('loginMessage', 'Wrong password'));\n    return done(null, user)\n  });\n}));\n"]}